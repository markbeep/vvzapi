{% extends "base_search.html" %}

{% block title %}<title>VVZ - {{ unit.title_english }}</title>{% endblock title %}

{% block content %}
<main class="grow p-4 sm:p-8">
    <div class="max-w-7xl mx-auto space-y-8">

        <header class="card bg-base-100 shadow-sm">
            <div class="card-body">
                <div class="flex flex-col gap-2">
                    <div class="flex flex-wrap items-center gap-2 mb-2">
                        <span class="badge badge-neutral font-mono">{{ unit.number }}</span>
                        <span class="badge badge-ghost font-mono">{{ unit.semkez }}</span>
                        {% if unit.credits %}
                        <span class="badge badge-success font-bold">{{ unit.credits }}
                            Credits</span>
                        {% endif %}
                        {% if unit.department %}
                        <span class="badge badge-outline">{{ unit.department }}</span>
                        {% endif %}
                    </div>

                    <h1 class="text-3xl font-bold text-base-content">
                        {{ unit.title_english if unit.title_english else unit.title }}
                    </h1>
                    {% if unit.title_english and unit.title and unit.title != unit.title_english %}
                    <h2 class="text-xl text-base-content/70 font-medium">{{ unit.title }}</h2>
                    {% endif %}

                    {% if unit.lecturers or lecturers %}
                    <div class="mt-4 text-sm text-base-content/80">
                        <span class="font-bold">Lecturers: </span>
                        {% for lecturer in lecturers %}
                        <span class="mr-2">{{ lecturer.surname }}
                            {{ lecturer.name }}{% if not loop.last %},{% endif %}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="card-actions justify-end absolute top-4 right-4">
                    <a target="_blank"
                        href="https://www.vvz.ethz.ch/Vorlesungsverzeichnis/lerneinheit.view?lerneinheitId={{ unit.id }}&semkez={{ unit.semkez }}&lang=en&ansicht=ALLE"
                        class="btn btn-sm btn-outline" title="VVZ">VVZ</a>
                    <a target="_blank" href="https://coursereview.ch/course/{{ unit.id }}"
                        class="btn btn-sm btn-outline" title="CourseReview">
                        CR
                    </a>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <div class="lg:col-span-2 space-y-6 [&>section>p]:whitespace-pre-wrap font-sans">

                {% if unit.abstract or unit.abstract_english %}
                <section class="card bg-base-100 shadow-sm">
                    <div class="card-body">
                        <h3 class="card-title text-lg font-bold border-b border-base-200 pb-2 mb-4">Abstract</h3>
                        <p class="max-w-none text-base-content/80 font-sans">
                            {{- unit.abstract_english if unit.abstract_english else unit.abstract -}}
                        </p>
                    </div>
                </section>
                {% endif %}

                {% if unit.objective or unit.objective_english %}
                <section class="card bg-base-100 shadow-sm">
                    <div class="card-body">
                        <h3 class="card-title text-lg font-bold border-b border-base-200 pb-2 mb-4">Objective</h3>
                        <p class="max-w-none text-base-content/80">
                            {{- unit.objective_english if unit.objective_english else unit.objective -}}
                        </p>
                    </div>
                </section>
                {% endif %}

                {% if unit.content or unit.content_english %}
                <section class="card bg-base-100 shadow-sm">
                    <div class="card-body">
                        <h3 class="card-title text-lg font-bold border-b border-base-200 pb-2 mb-4">Content</h3>
                        <p class="max-w-none text-base-content/80">
                            {{- unit.content_english if unit.content_english else unit.content -}}
                        </p>
                    </div>
                </section>
                {% endif %}

                {% if unit.literature or unit.literature_english or unit.lecture_notes or unit.learning_materials %}
                <section class="card bg-base-100 shadow-sm">
                    <div class="card-body">
                        <h3 class="card-title text-lg font-bold border-b border-base-200 pb-2 mb-4">Resources</h3>

                        {% if unit.lecture_notes or unit.lecture_notes_english %}
                        <div class="mb-4">
                            <h4 class="font-bold text-base-content text-sm mb-1">Lecture Notes</h4>
                            <p class="text-sm text-base-content/80">{{- unit.lecture_notes_english if
                                unit.lecture_notes_english else unit.lecture_notes -}}</p>
                        </div>
                        {% endif %}

                        {% if unit.literature or unit.literature_english %}
                        <div class="mb-4">
                            <h4 class="font-bold text-base-content text-sm mb-1">Literature</h4>
                            <p class="text-sm text-base-content/80">
                                {{- unit.literature_english if unit.literature_english else unit.literature -}}</p>
                        </div>
                        {% endif %}

                        {% if unit.learning_materials %}
                        <div class="mb-4">
                            <h4 class="font-bold text-base-content text-sm mb-1">Learning Materials (Links)</h4>
                            <ul class="list-disc list-inside text-sm text-primary">
                                {% for category, links in unit.learning_materials.items() %}
                                <li class="font-semibold text-base-content list-none mt-2">{{ category }}</li>
                                {% for link in links %}
                                <li class="ml-4"><a href="{{ link.url }}" target="_blank" class="link link-hover">
                                        {{ link.title or link.url }}</a></li>
                                {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </section>
                {% endif %}
            </div>

            <div class="space-y-6">

                <section class="card bg-base-100 shadow-sm text-sm">
                    <div class="card-body p-5">
                        <h3 class="font-bold text-base-content border-b border-base-200 pb-2 mb-3">General Information
                        </h3>
                        <dl class="space-y-2">
                            {% if unit.language %}
                            <div class="flex justify-between">
                                <dt class="text-base-content/60">Language</dt>
                                <dd class="font-medium text-base-content">{{ unit.language }}</dd>
                            </div>
                            {% endif %}

                            {% if unit.levels %}
                            <div class="flex justify-between">
                                <dt class="text-base-content/60">Levels</dt>
                                <dd class="font-medium text-base-content text-right">{{ unit.levels|join(', ') }}</dd>
                            </div>
                            {% endif %}

                            {% if unit.course_frequency %}
                            <div class="flex justify-between">
                                <dt class="text-base-content/60">Frequency</dt>
                                <dd class="font-medium text-base-content">{{ unit.course_frequency }}</dd>
                            </div>
                            {% endif %}
                        </dl>
                    </div>
                </section>

                <section class="card bg-base-100 shadow-sm text-sm">
                    <div class="card-body p-5">
                        <h3 class="font-bold text-base-content border-b border-base-200 pb-2 mb-3">Examination</h3>
                        <dl class="space-y-3">
                            {% if unit.exam_type %}
                            <div>
                                <dt class="text-base-content/60 text-xs uppercase tracking-wide">Type</dt>
                                <dd class="font-medium text-base-content">{{ unit.exam_type }}</dd>
                            </div>
                            {% endif %}

                            {% if unit.exam_mode %}
                            <div>
                                <dt class="text-base-content/60 text-xs uppercase tracking-wide">Mode</dt>
                                <dd class="font-medium text-base-content">{{ unit.exam_mode }}</dd>
                            </div>
                            {% endif %}

                            {% if unit.written_aids %}
                            <div>
                                <dt class="text-base-content/60 text-xs uppercase tracking-wide">Aids</dt>
                                <dd class="text-base-content/80">{{ unit.written_aids }}</dd>
                            </div>
                            {% endif %}

                            {% if unit.digital %}
                            <div>
                                <dt class="text-base-content/60 text-xs uppercase tracking-wide">Digital</dt>
                                <dd class="text-base-content/80">{{ unit.digital }}</dd>
                            </div>
                            {% endif %}
                        </dl>
                        {% if unit.additional_info %}
                        <div class="mt-3 pt-3 border-t border-base-200 text-base-content/70 italic">
                            {{ unit.additional_info }}
                        </div>
                        {% endif %}
                    </div>
                </section>

                <section class="card bg-base-100 shadow-sm text-sm">
                    <div class="card-body p-5">
                        <h3 class="font-bold text-base-content border-b border-base-200 pb-2 mb-3">Registration & Places
                        </h3>
                        <dl class="space-y-2">
                            {% if unit.max_places and unit.max_places > -1 %}
                            <div class="flex justify-between">
                                <dt class="text-base-content/60">Max Places</dt>
                                <dd class="font-medium text-base-content">{{ unit.max_places }}</dd>
                            </div>
                            {% elif unit.max_places == -1 %}
                            <div class="text-warning font-medium text-xs">
                                Limited places (Special selection)
                            </div>
                            {% endif %}

                            {% if unit.signup_start %}
                            <div class="flex justify-between">
                                <dt class="text-base-content/60">Signup Start</dt>
                                <dd class="font-medium text-base-content">{{ unit.signup_start }}</dd>
                            </div>
                            {% endif %}

                            {% if unit.signup_end %}
                            <div class="flex justify-between">
                                <dt class="text-base-content/60">Signup End</dt>
                                <dd class="font-medium text-base-content">{{ unit.signup_end }}</dd>
                            </div>
                            {% endif %}
                        </dl>
                        {% if unit.priority %}
                        <div class="mt-3 alert alert-warning p-2 text-xs">
                            <span><strong>Priority:</strong> {{ unit.priority }}</span>
                        </div>
                        {% endif %}
                    </div>
                </section>

            </div>
        </div>

        {% if courses %}
        <section class="mt-8">
            <h3 class="text-xl font-bold text-base-content mb-4">Course Components</h3>
            <div class="card bg-base-100 shadow-sm overflow-hidden overflow-x-auto">
                <table class="table table-zebra w-full text-left text-sm">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Time & Place</th>
                            <th>Hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for course in courses %}
                        <tr>
                            <td class="font-mono text-base-content/60">
                                {{ course.type.value if course.type else '?' }}
                            </td>
                            <td class="font-medium text-base-content">
                                {{ course.title if course.title else 'Course' }}
                                {% if course.comment %}
                                <div class="text-xs text-base-content/60 font-normal mt-1">{{ course.comment }}</div>
                                {% endif %}
                            </td>
                            <td class="text-base-content/80">
                                {% if course.timeslots %}
                                <ul class="space-y-1">
                                    {% for slot in course.timeslots %}
                                    <li>
                                        <span class="font-semibold">{{ slot.day }}</span>
                                        {{ slot.start }}-{{ slot.end }}
                                        {% if slot.room %}<span class="text-primary">({{ slot.room }})</span>
                                        {% endif %}
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <span class="text-base-content/40 italic">No time listed</span>
                                {% endif %}
                            </td>
                            <td class="text-base-content/70">
                                {{ course.hours }} {{ course.hour_type.value if course.hour_type else 'h' }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        {% endif %}

    </div>
</main>

{% endblock content %}
